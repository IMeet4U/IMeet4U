<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IMEET4U - Single-Page Application</title>
  <style>
    /* CSS Variables & Reset */
    :root {
      --color-primary: #FF6B6B;
      --color-secondary: #4ECDC4;
      --color-bg: #f7f7f7;
      --color-text: #333;
      --color-light: #fff;
      --color-muted: #666;
      --radius: 8px;
    }
    [data-theme="dark"] {
      --color-bg: #222;
      --color-text: #ddd;
      --color-light: #333;
      --color-muted: #aaa;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    html{font-size:16px;}
    body{font-family:'PingFang TC','Noto Sans TC',sans-serif;color:var(--color-text);background:var(--color-bg);}
    a, button{font-family:'PingFang TC','Noto Sans TC',sans-serif;text-decoration:none;color:inherit;background:none;border:none;cursor:pointer;}
    img{max-width:100%;height:auto;display:block;}

    /* Header */
    header{background:var(--color-light);padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
    .logo{font-size:1.5rem;font-weight:bold;color:var(--color-primary);}
    nav{display:flex;align-items:center;}
    nav a, nav button{margin-left:1rem;font-weight:500;color:var(--color-primary);}
    .btn-primary{padding:.75rem 1.5rem;background:var(--color-primary);color:var(--color-light);border-radius:var(--radius);}
    #auth-area{display:flex;align-items:center;}
    #sign-out{display:none;margin-left:1rem;font-weight:500;color:var(--color-primary);}
    #user-menu{position:absolute;top:2.5rem;right:0;background:var(--color-light);border:1px solid #ccc;border-radius:4px;display:none;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    #user-menu button{width:100%;padding:.5rem 1rem;text-align:left;}
    #user-email{display:none;padding:.75rem;color:var(--color-text);}
    .nav-item{display:none;}
    .nav-item.visible{display:inline-block;}

    /* SPA Pages + Transitions */
    .page{display:none;padding:2rem;opacity:0;transition:opacity .3s;}
    .page.active{display:block;opacity:1;}

    /* Hero */
    .hero{text-align:center;padding:4rem 2rem;background:linear-gradient(135deg,var(--color-primary) 0%,var(--color-secondary) 100%);color:var(--color-light);}
    .hero h1{font-size:2.5rem;line-height:1.2;margin-bottom:1rem;}
    .hero p{margin-bottom:2rem;font-size:1.125rem;}

    /* Features */
    .features{padding:3rem 2rem;background:var(--color-light);display:grid;gap:2rem;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));}
    .feature-card{background:var(--color-light);padding:1.5rem;border-radius:var(--radius);box-shadow:0 1px 3px rgba(0,0,0,0.1);text-align:center;transition:transform .2s;}
    .feature-card:hover{transform:translateY(-5px);}
    .feature-card h3{margin:1rem 0 .5rem;font-size:1.25rem;color:var(--color-primary);}
    .feature-card p{font-size:1rem;color:var(--color-muted);}

    /* About */
    #about p{max-width:600px;margin:1rem auto;line-height:1.6;}
    .team-section {
    max-width: 1000px;
    margin: 30px auto;
    text-align: center;
    }

    .team-members {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px; /* æ·»åŠ é–“è·ï¼Œå–ä»£ marginï¼Œç¢ºä¿é–“è·ä¸€è‡´ */
    }

    .member {
        flex: 1 1 200px; /* è¨­ç½®æ¯å€‹æˆå“¡å¡ç‰‡çš„æœ€å°å¯¬åº¦ï¼Œä¸¦å…è¨±éˆæ´»èª¿æ•´ */
        max-width: 220px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œé¿å…éå¯¬ */
        margin: 10px; /* çµ±ä¸€å¤–é‚Šè· */
        text-align: center;
        display: flex; /* ä½¿ç”¨ flex ä¾†å‚ç›´å°é½Šå…§å®¹ */
        flex-direction: column; /* å‚ç›´æ’åˆ—åœ–ç‰‡å’Œæ–‡å­— */
        align-items: center; /* æ°´å¹³å±…ä¸­ */
    }

    .member img {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #ffcc00;
        margin-bottom: 10px; /* ç¢ºä¿åœ–ç‰‡å’Œæ–‡å­—ä¹‹é–“æœ‰é–“è· */
    }

    .member h3 {
        margin: 0 0 5px; /* èª¿æ•´ h3 çš„é‚Šè·ï¼Œç§»é™¤é ‚éƒ¨å¤šé¤˜é–“è· */
        font-size: 1.2em;
        line-height: 1.2; /* ç¢ºä¿æ–‡å­—è¡Œé«˜ä¸€è‡´ */
    }

    .member p {
        margin: 0;
        color: #666;
        line-height: 1.2; /* ç¢ºä¿æ–‡å­—è¡Œé«˜ä¸€è‡´ */
    }

    /* Match */
    #match .card{background:var(--color-light);padding:2rem;margin-bottom:1rem;text-align:center;border-radius:var(--radius);box-shadow:0 1px 3px rgba(0,0,0,0.1);touch-action:pan-y;user-select:none;}
    #match .controls{text-align:center;margin-top:1rem;}
    #match .controls button{font-size:1.5rem;margin:0 .5rem;}

    /* Chat */
    #chat #chat-window{background:var(--color-light);border:1px solid #ccc;border-radius:4px;height:300px;overflow-y:auto;padding:1rem;}
    #chat .input-group{display:flex;margin-top:1rem;max-width:400px;}
    #chat input{flex:1;padding:.5rem;border:1px solid #ccc;border-radius:4px 0 0 4px;}
    #chat button{padding:.5rem 1rem;border:1px solid #ccc;border-left:none;border-radius:0 4px 4px 0;}

    /* Forms */
    .form-container{max-width:400px;margin:3rem auto;background:var(--color-light);padding:2rem;border-radius:var(--radius);box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    .form-container h2{margin-bottom:1rem;}
    .form-container label{display:block;margin-bottom:1rem;}
    .form-container input,.form-container select,.form-container textarea{width:100%;padding:.5rem;border:1px solid #ccc;border-radius:4px;}
    .form-container button{width:100%;padding:.75rem;background:var(--color-primary);color:var(--color-light);border-radius:var(--radius);}

    /* Survey Specific Styles */
    .form-container .survey-question {margin-bottom: 1.5rem;}
    .form-container .survey-question label {font-weight: bold; margin-bottom: 0.5rem;}
    .form-container .survey-question div {display: flex; flex-wrap: wrap; gap: 10px;}
    .form-container .survey-question input[type="checkbox"], 
    .form-container .survey-question input[type="radio"] {width: auto; margin-right: 5px;}
    .form-container .survey-question span {margin-right: 15px;}

    /* Modal */
    .modal-backdrop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;}
    .modal-backdrop.active{display:flex;}
    .modal{background:var(--color-light);padding:2rem;border-radius:var(--radius);max-width:500px;width:90%;max-height:90%;overflow:auto;}

    /* Calendar */
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;}
    .calendar .header{font-weight:bold;color:var(--color-primary);}
    .calendar div{padding:.5rem;text-align:center;border-radius:4px;background:var(--color-light);}

    /* Footer */
    footer{text-align:center;padding:2rem 0;}

    /* Debug Output */
    #debug-output {
      margin-top: 1rem;
      color: #d32f2f;
      font-size: 0.9rem;
      word-wrap: break-word;
    }

    @media(max-width:768px){header{padding:1rem;}nav a,nav button{margin-left:.75rem;font-size:.9rem;} .hero h1{font-size:2rem;} .hero p{font-size:1rem;} .features{padding:2rem 1rem;}}
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, get, push } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyALscFG5EEzN5KanfiXzdw59nxh62z81OA",
      authDomain: "imeet4u-98171.firebaseapp.com",
      databaseURL: "https://imeet4u-98171-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "imeet4u-98171",
      storageBucket: "imeet4u-98171.firebasestorage.app",
      messagingSenderId: "979771631163",
      appId: "1:979771631163:web:2d8bf880b8a1b2c0295e1e",
      measurementId: "G-5LWNP5H2SP"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // è¨»å†Šå‡½æ•¸
    window.writedata = async function() {
      var email = document.getElementById("userEmail").value.toLowerCase().trim();
      var password = document.getElementById("userPassword").value;
      var confirmPassword = document.getElementById("userCPassword").value;

      if (!email || !password || !confirmPassword) {
        alert("Please fill in all fields.");
        return;
      }

      if (password !== confirmPassword) {
        alert("Passwords do not match!");
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        const newUserRef = push(ref(database, '/users')); // ç”Ÿæˆå”¯ä¸€ ID
        await set(newUserRef, {
          email: email,
          uid: user.uid
        });

        // é©—è­‰ä¸¦èª¿è©¦
        const signInMethods = await fetchSignInMethodsForEmail(auth, email);
        console.log("Registration completed for", email, "UID:", user.uid, "Providers:", user.providerData, "Sign-in methods:", signInMethods);
        alert("User registered successfully!");
        document.getElementById("register-form").reset();
        location.hash = "login";
      } catch (error) {
        console.error("Error registering user:", error);
        alert("Failed to register: " + error.message);
      }
    };

    // è®€å–æ•¸æ“šå‡½æ•¸
    window.selectdata = function() {
      const dbRef = ref(database, '/users');
      onValue(dbRef, (snapshot) => {
        const data = snapshot.val();
        var html_text = "";
        if (data) {
          for (let key in data) {
            html_text += "<a href=\"#\" id=\"t" + key + "\" onClick=\"selectid('" + key + "')\">ç¬¬" + key + "ç­†</a><ol><li id=\"z1_value_2_" + key + "\">" + data[key].email + "</li></ol><br>";
          }
        }
      }, (error) => {
        console.error("Error reading data:", error);
      });
    };

    // é¸å–è¨˜éŒ„å‡½æ•¸
    window.selectid = function(id) {
      window.select_id = id;
      alert("Selected record: " + id);
    };

    // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²å®Œæˆ Profile å’Œ Survey
    async function checkUserProgress(user) {
      const profileRef = ref(database, '/profiles/' + user.uid);
      const surveyRef = ref(database, '/surveys/' + user.uid);
      
      const profileSnapshot = await get(profileRef);
      const surveySnapshot = await get(surveyRef);
      
      return {
        hasProfile: profileSnapshot.exists(),
        hasSurvey: surveySnapshot.exists()
      };
    }

    // æ›´æ–°å°èˆªæ¬„é¡¯ç¤ºï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
    window.updateNavigation = function(user, hasProfile, hasSurvey, isLoggedIn = false) {
      const authArea = document.getElementById('auth-area');
      const userEmail = document.getElementById('user-email');
      const signOutBtn = document.getElementById('sign-out');
      const navItems = document.querySelectorAll('.nav-item');

      if (user && isLoggedIn) {
        authArea.style.display = 'none';
        userEmail.textContent = user.email;
        userEmail.style.display = 'block';
        signOutBtn.style.display = 'inline-block';

        if (hasProfile && hasSurvey) {
          navItems.forEach(item => item.classList.add('visible'));
        } else {
          navItems.forEach(item => {
            if (item.id === 'nav-home' || item.id === 'nav-about') {
              item.classList.add('visible');
            } else {
              item.classList.remove('visible');
            }
          });
        }
      } else {
        authArea.style.display = 'flex';
        userEmail.style.display = 'none';
        signOutBtn.style.display = 'none';
        navItems.forEach(item => item.classList.remove('visible'));
      }
    };

    // ç™»å‡ºå‡½æ•¸
    window.signOutUser = async function() {
      try {
        await signOut(auth);
        alert("Logged out successfully!");
        location.hash = "home";
        window.updateNavigation(null, false, false, false);
      } catch (error) {
        console.error("Error signing out:", error);
        alert("Failed to sign out: " + error.message);
      }
    };

    // ç™»å…¥å‡½æ•¸
    window.logindata = async function() {
      var email = document.querySelector("#login-form [name='username']").value.toLowerCase().trim();
      var password = document.querySelector("#login-form [name='password']").value;

      if (!email || !password) {
        alert("Please fill in all fields.");
        return;
      }

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        alert("Login successful!");

        const { hasProfile, hasSurvey } = await checkUserProgress(user);
        window.updateNavigation(user, hasProfile, hasSurvey, true);

        if (!hasProfile) {
          document.getElementById("profile-form").reset();
          location.hash = "profile";
        } else if (!hasSurvey) {
          location.hash = "survey";
        } else {
          location.hash = "home";
        }
      } catch (error) {
        console.error("Error logging in:", error);
        alert("Failed to login: " + error.message);
      }
    };

    // é‡è¨­å¯†ç¢¼å‡½æ•¸
    window.resetPassword = async function() {
      var email = document.getElementById("reset-email").value.toLowerCase().trim();
      const debugOutput = document.getElementById("debug-output");
      if (!email) {
        alert("Please enter your email address.");
        return;
      }

      try {
        // æª¢æŸ¥ Realtime Database ä¸­çš„ç”¨æˆ¶è¨˜éŒ„
        const usersRef = ref(database, '/users');
        const snapshot = await get(usersRef);
        let emailExists = false;

        if (snapshot.exists()) {
          const users = snapshot.val();
          for (let key in users) {
            if (users[key].email === email) {
              emailExists = true;
              break;
            }
          }
        }

        if (!emailExists) {
          alert("This account does not exist in our records. Please register first.");
          debugOutput.textContent = `Email ${email} not found in database.`;
          return;
        }

        // å˜—è©¦ç™¼é€é‡è¨­å¯†ç¢¼éƒµä»¶
        await sendPasswordResetEmail(auth, email);
        alert("Password reset email sent! Please check your inbox.");
        debugOutput.textContent = "Password reset email sent successfully.";
        document.getElementById("forgot-password-form").reset();
        location.hash = "login";
      } catch (error) {
        console.error("Error:", error);
        debugOutput.textContent = `Error: ${error.code || error.message} - Details: ${JSON.stringify(error)}`;
        if (error.code === 'auth/invalid-email') {
          alert("Invalid email format. Please try again.");
        } else if (error.code === 'auth/too-many-requests') {
          alert("Too many requests. Please try again later.");
        } else {
          alert("Failed to send reset email: " + error.message);
        }
      }
    };

    // ç›£è½èº«ä»½ç‹€æ…‹è®ŠåŒ–ä¸¦å¡«å…… Survey è¡¨å–®
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const { hasProfile, hasSurvey } = await checkUserProgress(user);

        const profileRef = ref(database, '/profiles/' + user.uid);
        onValue(profileRef, (snapshot) => {
          const data = snapshot.val();
          if (data) {
            document.querySelector("#profile-form [name='name']").value = data.name || '';
            document.querySelector("#profile-form [name='bio']").value = data.bio || '';
          }
        });

        const surveyRef = ref(database, '/surveys/' + user.uid);
        onValue(surveyRef, (snapshot) => {
          const data = snapshot.val();
          if (data) {
            // å¡«å…… Survey è¡¨å–®
            // å•é¡Œ 1: Favorite Sport
            if (data.favoriteSport) {
              data.favoriteSport.forEach(sport => {
                document.querySelector(`input[name="favoriteSport"][value="${sport}"]`).checked = true;
              });
            }
            // å•é¡Œ 2: Free Time Activities
            if (data.freeTimeActivities) {
              data.freeTimeActivities.forEach(activity => {
                document.querySelector(`input[name="freeTimeActivities"][value="${activity}"]`).checked = true;
              });
            }
            // å•é¡Œ 3: Time on Hobbies
            if (data.timeOnHobbies) {
              document.querySelector(`input[name="timeOnHobbies"][value="${data.timeOnHobbies}"]`).checked = true;
            }
            // å•é¡Œ 4: Music Preference
            if (data.musicPreference) {
              data.musicPreference.forEach(music => {
                document.querySelector(`input[name="musicPreference"][value="${music}"]`).checked = true;
              });
            }
            // å•é¡Œ 5: Book Preference
            if (data.bookPreference) {
              data.bookPreference.forEach(book => {
                document.querySelector(`input[name="bookPreference"][value="${book}"]`).checked = true;
              });
            }
            // å•é¡Œ 6: Movie Preference
            if (data.moviePreference) {
              data.moviePreference.forEach(movie => {
                document.querySelector(`input[name="moviePreference"][value="${movie}"]`).checked = true;
              });
            }
            // å•é¡Œ 7: Personality Rating
            if (data.personalityRating) {
              document.querySelector(`input[name="personalityRating"][value="${data.personalityRating}"]`).checked = true;
            }
          }
        });

        window.updateNavigation(user, hasProfile, hasSurvey, false);
      } else {
        window.updateNavigation(null, false, false, false);
        location.hash = "home"; // æœªç™»å…¥æ™‚è·³å›é¦–é 
      }
    });

    // åˆå§‹åŠ è¼‰æ•¸æ“š
    selectdata();

    // å„²å­˜ Profile è³‡è¨Š
    window.saveProfile = async function() {
      var name = document.querySelector("#profile-form [name='name']").value;
      var bio = document.querySelector("#profile-form [name='bio']").value;

      if (!name || !bio) {
        alert("Please fill in all fields.");
        return;
      }

      const user = auth.currentUser;
      if (user) {
        await set(ref(database, '/profiles/' + user.uid), {
          name: name,
          bio: bio
        });
        alert("Profile saved successfully!");
        const { hasSurvey } = await checkUserProgress(user);
        if (hasSurvey) {
          location.hash = "home";
        } else {
          location.hash = "survey";
        }
      }
    };

    // å„²å­˜ Survey è³‡è¨Š
    window.saveSurvey = async function() {
      const user = auth.currentUser;
      if (!user) {
        alert("Please log in to save your survey.");
        return;
      }

      // æ”¶é›†è¡¨å–®ç­”æ¡ˆ
      const favoriteSportInputs = document.querySelectorAll('input[name="favoriteSport"]:checked');
      const freeTimeActivitiesInputs = document.querySelectorAll('input[name="freeTimeActivities"]:checked');
      const timeOnHobbiesInput = document.querySelector('input[name="timeOnHobbies"]:checked');
      const musicPreferenceInputs = document.querySelectorAll('input[name="musicPreference"]:checked');
      const bookPreferenceInputs = document.querySelectorAll('input[name="bookPreference"]:checked');
      const moviePreferenceInputs = document.querySelectorAll('input[name="moviePreference"]:checked');
      const personalityRatingInput = document.querySelector('input[name="personalityRating"]:checked');

      // é©—è­‰æœ€å¤šé¸æ“‡æ•¸é‡
      if (favoriteSportInputs.length > 2) {
        alert("Please select up to 2 options for Favorite Sport.");
        return;
      }
      if (freeTimeActivitiesInputs.length > 2) {
        alert("Please select up to 2 options for Free Time Activities.");
        return;
      }
      if (!timeOnHobbiesInput) {
        alert("Please select an option for Time Spent on Hobbies.");
        return;
      }
      if (musicPreferenceInputs.length > 2) {
        alert("Please select up to 2 options for Music Preference.");
        return;
      }
      if (bookPreferenceInputs.length > 2) {
        alert("Please select up to 2 options for Book Preference.");
        return;
      }
      if (moviePreferenceInputs.length > 2) {
        alert("Please select up to 2 options for Movie Preference.");
        return;
      }
      if (!personalityRatingInput) {
        alert("Please select an option for Personality Rating.");
        return;
      }

      // æå–é¸æ“‡çš„å€¼
      const favoriteSport = Array.from(favoriteSportInputs).map(input => input.value);
      const freeTimeActivities = Array.from(freeTimeActivitiesInputs).map(input => input.value);
      const timeOnHobbies = timeOnHobbiesInput.value;
      const musicPreference = Array.from(musicPreferenceInputs).map(input => input.value);
      const bookPreference = Array.from(bookPreferenceInputs).map(input => input.value);
      const moviePreference = Array.from(moviePreferenceInputs).map(input => input.value);
      const personalityRating = personalityRatingInput.value;

      // å„²å­˜åˆ°è³‡æ–™åº«
      await set(ref(database, '/surveys/' + user.uid), {
        favoriteSport: favoriteSport,
        freeTimeActivities: freeTimeActivities,
        timeOnHobbies: timeOnHobbies,
        musicPreference: musicPreference,
        bookPreference: bookPreference,
        moviePreference: moviePreference,
        personalityRating: personalityRating,
        completed: true
      });

      alert("Survey saved successfully!");
      location.hash = "home";
      const { hasProfile, hasSurvey } = await checkUserProgress(user);
      window.updateNavigation(user, hasProfile, hasSurvey, true);
    };

    // é™åˆ¶æœ€å¤šé¸æ“‡å…©å€‹é¸é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆæ‰èƒ½é¸æ–°é¸é …
    function limitCheckboxSelection(name) {
      const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function(e) {
          const checkedBoxes = document.querySelectorAll(`input[name="${name}"]:checked`);
          if (checkedBoxes.length > 2) {
            e.preventDefault(); // é˜»æ­¢æ–°é¸é …è¢«é¸ä¸­
            this.checked = false; // ç¢ºä¿æ–°é¸é …æœªè¢«é¸ä¸­
            alert("You can only select up to 2 options. Please uncheck one option to select a new one.");
          }
        });
      });
    }

    // åˆå§‹åŒ–é™åˆ¶é‚è¼¯
    window.onload = function() {
      // é™åˆ¶å¤šé¸é¡Œï¼ˆç¬¬1ã€2ã€4ã€5ã€6é¡Œï¼‰
      limitCheckboxSelection('favoriteSport');
      limitCheckboxSelection('freeTimeActivities');
      limitCheckboxSelection('musicPreference');
      limitCheckboxSelection('bookPreference');
      limitCheckboxSelection('moviePreference');

      // Dark Mode Toggle
      const saved = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', saved);
      document.getElementById('dark-toggle').onclick = () => {
        const cur = document.body.getAttribute('data-theme');
        const nxt = cur === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', nxt);
        localStorage.setItem('theme', nxt);
      };

      // SPA Routing
      function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.toggle('active', p.id === id));
        if (id === 'login') {
          document.getElementById('login-form').reset();
        } else if (id === 'forgot-password') {
          document.getElementById('forgot-password-form').reset();
        } else if (id === 'survey') {
          // é‡ç½®è¡¨å–®ï¼Œä½†ä¿ç•™å¾è³‡æ–™åº«åŠ è¼‰çš„æ•¸æ“š
          document.getElementById('survey-form').reset();
        }
      }
      document.body.addEventListener('click', e => {
        const tgt = e.target.closest('[data-target]');
        if (tgt) {
          location.hash = tgt.dataset.target;
        }
      });
      window.addEventListener('hashchange', () => showPage(location.hash.slice(1)));
      if (location.hash) showPage(location.hash.slice(1)); else location.hash = "home";

      // Match Controls
      document.getElementById('dislike').onclick = () => alert("Disliked!");
      document.getElementById('like').onclick = () => alert("Liked!");

      // Chat Send Button
      document.getElementById('send').onclick = () => {
        const msg = document.getElementById('msg').value;
        if (msg) {
          const chatWindow = document.getElementById('chat-window');
          chatWindow.innerHTML += `<p>${msg}</p>`;
          document.getElementById('msg').value = '';
          chatWindow.scrollTop = chatWindow.scrollHeight;
        }
      };

      // Profile and Settings Form Submission
      document.getElementById('profile-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.saveProfile();
      });
      document.getElementById('settings-form').onsubmit = (e) => {
        e.preventDefault();
        alert("Settings saved!");
      };

      // Register Form Submission
      document.getElementById('register-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.writedata();
      });

      // Login Form Submission
      document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.logindata();
      });

      // Forgot Password Form Submission
      document.getElementById('forgot-password-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.resetPassword();
      });

      // Survey Form Submission
      document.getElementById('survey-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.saveSurvey();
      });

      // åˆå§‹è¨­å®šæœªç™»å…¥ç‹€æ…‹
      updateNavigation(null, false, false, false);
    };

    // ç›£è½é é¢åˆ·æ–°ä¸¦è·³å›é¦–é 
    window.onbeforeunload = function() {
      location.hash = "home"; // è¨­ç½®åˆ·æ–°å¾Œçš„é»˜èªé é¢
      signOut(auth).catch(error => console.error("Error signing out on unload:", error));
    };
  </script>
</head>
<body data-theme="light">

  <header> 
    <!-- Home function icon -->
    <div class="logo">IMEET4U</div>
    <nav>
      <a id="nav-home" data-target="home">Home</a>
      <a id="nav-about" data-target="about">About Us</a>
      <a id="nav-match" class="nav-item" data-target="match">Matching</a>
      <a id="nav-chat" class="nav-item" data-target="chat">Chat</a>
      <a id="nav-profile" class="nav-item" data-target="profile">Profile</a>
      <a id="nav-settings" class="nav-item" data-target="settings">Preferences</a>
      <a id="nav-calendar" class="nav-item" data-target="calendar">Calendar</a>
      <a id="nav-survey" class="nav-item" data-target="survey">Survey</a>
      <button id="dark-toggle">ğŸŒ™</button>
      <div id="auth-area">
        <a data-target="login">Log In</a>
        <a data-target="register" class="btn-primary">Sign Up</a>
        <a data-target="forgot-password">Forgot Password</a>
      </div>
      <div id="user-email"></div>
      <button id="sign-out" onclick="signOutUser()">Sign Out</button>
    </nav>
  </header>

  <main>
    <!-- Home -->
    <section id="home" class="page active">
      <div class="hero">
        <h1>Discover<br>Meaningful<br>Connections</h1>
        <p>Join IMEET4U and start your romantic journey</p>
        <a class="btn-primary" data-target="register">Join Now</a>
      </div>
      <div class="features">
        <div class="feature-card"><img src="MATCH.png" alt="Match Icon"><h3>Matching System</h3><p>Swipe cards to quickly find ideal matches</p></div>
        <div class="feature-card"><img src="CHAT.png" alt="Chat Icon"><h3>Instant Chat</h3><p>One-on-one chat for real interaction</p></div>
        <div class="feature-card"><img src="PROFILE.png" alt="Profile Icon"><h3>Profile</h3><p>Show your true self</p></div>
        <div class="feature-card"><img src="PREFERENCE.png" alt="Preferences Icon"><h3>Preferences</h3><p>Customize filters to optimize matching</p></div>
      </div>
    </section>

    <!-- About -->
    <section id="about" class="page">
      <h2>About Us</h2>
      <p>IMEET4U is a dating app designed for modern singles, providing powerful matching, chat, and customization features to help you connect with like-minded people.</p>
      <h2>Meet Our Team</h2>
      <section class="team-section">
        <div class="team-members">
            <div class="member">
                <img src="Jack.jpg" alt="Guan-Yi Wu">
                <h3>Guan-Yi Wu (Jack)</h3>
                <p>Information Management, NTPU</p>
            </div>
            <div class="member">
                <img src="Jerry.png" alt="Zhong-Rui Tsai">
                <h3>Zhong-Rui Tsai (Jerry)</h3>
                <p>Information Management, NTPU</p>
            </div>
            <div class="member">
                <img src="Najeeb.png" alt="Najeeb Ullah">
                <h3>Najeeb Ullah (Nur)</h3>
                <p>Smart Healthcare and Management, NTPU</p>
            </div>
        </div>
      </section>
    </section>

    <!-- Match -->
    <section id="match" class="page">
      <h2>Matching</h2>
      <div id="swipe-container">
        <div class="card">User A</div>
        <div class="card">User B</div>
        <div class="card">User C</div>
      </div>
      <div class="controls">
        <button id="dislike">ğŸ‘</button>
        <button id="like">ğŸ‘</button>
      </div>
    </section>

    <!-- Chat -->
    <section id="chat" class="page">
      <h2>Chat</h2>
      <div id="chat-window"></div>
      <div class="input-group">
        <input id="msg" placeholder="Type a message...">
        <button id="send">Send</button>
      </div>
    </section>

    <!-- Profile -->
    <section id="profile" class="page">
      <h2>My Profile</h2>
      <form class="form-container" id="profile-form">
        <label>Name:<input name="name" required></label>
        <label>Introduction:<textarea name="bio" required></textarea></label>
        <button type="submit" onclick="saveProfile(); return false;">Save</button>
      </form>
    </section>

    <!-- Settings -->
    <section id="settings" class="page">
      <h2>Preferences</h2>
      <form class="form-container" id="settings-form">
        <label>Gender Preference:
          <select name="gender">
            <option>No Preference</option>
            <option>Female</option>
            <option>Male</option>
          </select>
        </label>
        <label>Age Range:<input type="number" name="ageMin" placeholder="Min"> â€“ <input type="number" name="ageMax" placeholder="Max"></label>
        <button type="submit">Save Settings</button>
      </form>
    </section>

    <!-- Calendar -->
    <section id="calendar" class="page">
      <h2>Calendar</h2>
      <div class="calendar" id="calendar-grid"></div>
    </section>

    <!-- Login -->
    <section id="login" class="page">
      <div class="form-container">
        <h2>Log In</h2>
        <form id="login-form">
          <label>Username or Email:<input name="username" required></label>
          <label>Password:<input type="password" name="password" required></label>
          <button type="submit">Log In</button>
        </form>
        <p><a data-target="forgot-password">Forgot Password?</a></p>
      </div>
    </section>

    <!-- Register -->
    <section id="register" class="page">
      <div class="form-container">
        <h2>Sign Up</h2>
        <form id="register-form">
          <label>Email:<input type="email" name="email" id="userEmail" required></label>
          <label>Password:<input type="password" name="password" id="userPassword" required minlength="6"></label>
          <label>Confirm Password:<input type="password" name="confirm_password" id="userCPassword" required></label>
          <button type="submit" id="sign-up-btn">Sign Up</button>
        </form>
      </div>
    </section>

    <!-- Forgot Password -->
    <section id="forgot-password" class="page">
      <div class="form-container">
        <h2>Forgot Password</h2>
        <form id="forgot-password-form">
          <label>Email:<input type="email" id="reset-email" required></label>
          <button type="submit" onclick="resetPassword(); return false;">Send Reset Email</button>
        </form>
        <p id="debug-output"></p>
        <p><a data-target="login">Back to Log In</a></p>
      </div>
    </section>

    <!-- Survey -->
    <section id="survey" class="page">
      <h2>Personality Survey</h2>
      <div class="form-container">
        <form id="survey-form">
          <!-- å•é¡Œ 1: æœ€å–œæ­¡çš„é‹å‹•ï¼ˆæœ€å¤šé¸2é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆï¼‰ -->
          <div class="survey-question">
            <label>1. What's your favorite sport? (Select up to 2)</label>
            <div>
              <label><input type="checkbox" name="favoriteSport" value="Basketball"> Basketball</label>
              <label><input type="checkbox" name="favoriteSport" value="Volleyball"> Volleyball</label>
              <label><input type="checkbox" name="favoriteSport" value="Badminton"> Badminton</label>
              <label><input type="checkbox" name="favoriteSport" value="Pool"> Pool</label>
              <label><input type="checkbox" name="favoriteSport" value="Tennis"> Tennis</label>
              <label><input type="checkbox" name="favoriteSport" value="Table Tennis"> Table Tennis</label>
            </div>
          </div>

          <!-- å•é¡Œ 2: ç©ºé–’æ™‚é–“å–œæ­¡åšä»€éº¼ï¼ˆæœ€å¤šé¸2é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆï¼‰ -->
          <div class="survey-question">
            <label>2. What do you like to do in your free time? (Select up to 2)</label>
            <div>
              <label><input type="checkbox" name="freeTimeActivities" value="Singing"> Singing</label>
              <label><input type="checkbox" name="freeTimeActivities" value="Dancing"> Dancing</label>
              <label><input type="checkbox" name="freeTimeActivities" value="Reading"> Reading</label>
              <label><input type="checkbox" name="freeTimeActivities" value="Watching Movies"> Watching Movies</label>
              <label><input type="checkbox" name="freeTimeActivities" value="Exercising"> Exercising</label>
              <label><input type="checkbox" name="freeTimeActivities" value="Traveling"> Traveling</label>
            </div>
          </div>

          <!-- å•é¡Œ 3: é€šå¸¸èŠ±å¤šå°‘æ™‚é–“åœ¨èˆˆè¶£ä¸Šï¼ˆå–®é¸ï¼‰ -->
          <div class="survey-question">
            <label>3. How much time do you usually spend on your hobbies? (Select one)</label>
            <div>
              <label><input type="radio" name="timeOnHobbies" value="Less than 1 hour"> Less than 1 hour</label>
              <label><input type="radio" name="timeOnHobbies" value="2 hours"> 2 hours</label>
              <label><input type="radio" name="timeOnHobbies" value="3 hours"> 3 hours</label>
              <label><input type="radio" name="timeOnHobbies" value="More than 4 hours"> More than 4 hours</label>
            </div>
          </div>

          <!-- å•é¡Œ 4: å–œæ­¡ä»€éº¼é¡å‹çš„éŸ³æ¨‚ï¼ˆæœ€å¤šé¸2é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆï¼‰ -->
          <div class="survey-question">
            <label>4. What kind of music do you like? (Select up to 2)</label>
            <div>
              <label><input type="checkbox" name="musicPreference" value="Classical"> Classical</label>
              <label><input type="checkbox" name="musicPreference" value="Rock"> Rock</label>
              <label><input type="checkbox" name="musicPreference" value="Pop"> Pop</label>
              <label><input type="checkbox" name="musicPreference" value="Romantic"> Romantic</label>
              <label><input type="checkbox" name="musicPreference" value="Love Song"> Love Song</label>
            </div>
          </div>

          <!-- å•é¡Œ 5: å–œæ­¡ä»€éº¼é¡å‹çš„æ›¸ï¼ˆæœ€å¤šé¸2é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆï¼‰ -->
          <div class="survey-question">
            <label>5. What type of books do you like? (Select up to 2)</label>
            <div>
              <label><input type="checkbox" name="bookPreference" value="Romance"> Romance</label>
              <label><input type="checkbox" name="bookPreference" value="Horror"> Horror</label>
              <label><input type="checkbox" name="bookPreference" value="Martial Arts"> Martial Arts</label>
              <label><input type="checkbox" name="bookPreference" value="Suspense"> Suspense</label>
              <label><input type="checkbox" name="bookPreference" value="Fantasy"> Fantasy</label>
              <label><input type="checkbox" name="bookPreference" value="Animation"> Animation</label>
            </div>
          </div>

          <!-- å•é¡Œ 6: å–œæ­¡ä»€éº¼é¡å‹çš„é›»å½±ï¼ˆæœ€å¤šé¸2é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆï¼‰ -->
          <div class="survey-question">
            <label>6. What kind of movies do you like? (Select up to 2)</label>
            <div>
              <label><input type="checkbox" name="moviePreference" value="Romance"> Romance</label>
              <label><input type="checkbox" name="moviePreference" value="Horror"> Horror</label>
              <label><input type="checkbox" name="moviePreference" value="Martial Arts"> Martial Arts</label>
              <label><input type="checkbox" name="moviePreference" value="Suspense"> Suspense</label>
              <label><input type="checkbox" name="moviePreference" value="Fantasy"> Fantasy</label>
              <label><input type="checkbox" name="moviePreference" value="Animation"> Animation</label>
            </div>
          </div>

          <!-- å•é¡Œ 7: æ€§æ ¼è©•åˆ†ï¼ˆå–®é¸ï¼‰ -->
          <div class="survey-question">
            <label>7. How would you rate your personality? (1 is more introverted and shy, 10 is more extroverted and lively)</label>
            <div>
              <label><input type="radio" name="personalityRating" value="1"> 1</label>
              <label><input type="radio" name="personalityRating" value="2"> 2</label>
              <label><input type="radio" name="personalityRating" value="3"> 3</label>
              <label><input type="radio" name="personalityRating" value="4"> 4</label>
              <label><input type="radio" name="personalityRating" value="5"> 5</label>
              <label><input type="radio" name="personalityRating" value="6"> 6</label>
              <label><input type="radio" name="personalityRating" value="7"> 7</label>
              <label><input type="radio" name="personalityRating" value="8"> 8</label>
              <label><input type="radio" name="personalityRating" value="9"> 9</label>
              <label><input type="radio" name="personalityRating" value="10"> 10</label>
            </div>
          </div>

          <button type="submit" onclick="saveSurvey(); return false;">Save</button>
        </form>
      </div>
    </section>
  </main>

  <footer>Â© 2025 IMEET4U. All Rights Reserved.</footer>

  <script>
    window.onload = function() {
      // é™åˆ¶å¤šé¸é¡Œï¼ˆç¬¬1ã€2ã€4ã€5ã€6é¡Œï¼‰
      limitCheckboxSelection('favoriteSport');
      limitCheckboxSelection('freeTimeActivities');
      limitCheckboxSelection('musicPreference');
      limitCheckboxSelection('bookPreference');
      limitCheckboxSelection('moviePreference');

      // Dark Mode Toggle
      const saved = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', saved);
      document.getElementById('dark-toggle').onclick = () => {
        const cur = document.body.getAttribute('data-theme');
        const nxt = cur === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', nxt);
        localStorage.setItem('theme', nxt);
      };

      // SPA Routing
      function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.toggle('active', p.id === id));
        if (id === 'login') {
          document.getElementById('login-form').reset();
        } else if (id === 'forgot-password') {
          document.getElementById('forgot-password-form').reset();
        } else if (id === 'survey') {
          // é‡ç½®è¡¨å–®ï¼Œä½†ä¿ç•™å¾è³‡æ–™åº«åŠ è¼‰çš„æ•¸æ“š
          document.getElementById('survey-form').reset();
        }
      }
      document.body.addEventListener('click', e => {
        const tgt = e.target.closest('[data-target]');
        if (tgt) {
          location.hash = tgt.dataset.target;
        }
      });
      window.addEventListener('hashchange', () => showPage(location.hash.slice(1)));
      if (location.hash) showPage(location.hash.slice(1)); else location.hash = "home";

      // Match Controls
      document.getElementById('dislike').onclick = () => alert("Disliked!");
      document.getElementById('like').onclick = () => alert("Liked!");

      // Chat Send Button
      document.getElementById('send').onclick = () => {
        const msg = document.getElementById('msg').value;
        if (msg) {
          const chatWindow = document.getElementById('chat-window');
          chatWindow.innerHTML += `<p>${msg}</p>`;
          document.getElementById('msg').value = '';
          chatWindow.scrollTop = chatWindow.scrollHeight;
        }
      };

      // Profile and Settings Form Submission
      document.getElementById('profile-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.saveProfile();
      });
      document.getElementById('settings-form').onsubmit = (e) => {
        e.preventDefault();
        alert("Settings saved!");
      };

      // Register Form Submission
      document.getElementById('register-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.writedata();
      });

      // Login Form Submission
      document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.logindata();
      });

      // Forgot Password Form Submission
      document.getElementById('forgot-password-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.resetPassword();
      });

      // Survey Form Submission
      document.getElementById('survey-form').addEventListener('submit', (e) => {
        e.preventDefault();
        window.saveSurvey();
      });

      // åˆå§‹è¨­å®šæœªç™»å…¥ç‹€æ…‹
      updateNavigation(null, false, false, false);
    };

    // é™åˆ¶æœ€å¤šé¸æ“‡å…©å€‹é¸é …ï¼Œéœ€æ‰‹å‹•å–æ¶ˆæ‰èƒ½é¸æ–°é¸é …
    function limitCheckboxSelection(name) {
      const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function(e) {
          const checkedBoxes = document.querySelectorAll(`input[name="${name}"]:checked`);
          if (checkedBoxes.length > 2) {
            e.preventDefault(); // é˜»æ­¢æ–°é¸é …è¢«é¸ä¸­
            this.checked = false; // ç¢ºä¿æ–°é¸é …æœªè¢«é¸ä¸­
            alert("You can only select up to 2 options. Please uncheck one option to select a new one.");
          }
        });
      });
    }

    // ç›£è½é é¢åˆ·æ–°ä¸¦è·³å›é¦–é 
    window.onbeforeunload = function() {
      location.hash = "home"; // è¨­ç½®åˆ·æ–°å¾Œçš„é»˜èªé é¢
      signOut(auth).catch(error => console.error("Error signing out on unload:", error));
    };
  </script>
</body>
</html>
